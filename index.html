<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>èª²å ‚åˆ†çµ„ç³»çµ± PRO+</title>

<style>
body {
  font-family: "Microsoft JhengHei", Arial;
  background:#eef2f7;
  padding:20px;
}
h1{text-align:center;}

button{
  font-size:18px;
  padding:12px 18px;
  margin:5px;
  border:none;
  border-radius:10px;
  cursor:pointer;
}
.primary{background:#2563eb;color:white;}
.gray{background:#6b7280;color:white;}

.group{
  background:white;
  margin:12px 0;
  padding:16px;
  border-radius:14px;
  font-size:32px;
  animation: pop .5s ease;
  box-shadow:0 4px 10px rgba(0,0,0,.15);
}

.member{
  display:inline-block;
  padding:8px 14px;
  margin:6px;
  background:#e0e7ff;
  border-radius:12px;
}

@keyframes pop{
  from{transform:scale(.8);opacity:0;}
  to{transform:scale(1);opacity:1;}
}

.draw{
  font-size:56px;
  text-align:center;
  margin:20px;
  animation: flash .8s infinite alternate;
}

@keyframes flash{
  from{opacity:.3;}
  to{opacity:1;}
}
</style>
</head>

<body>

<h1>ğŸ“ èª²å ‚åˆ†çµ„ç³»çµ± PRO+</h1>

<textarea id="students" rows="6" placeholder="å­¸ç”Ÿåå–®ï¼ˆæ¯è¡Œä¸€äººï¼‰"></textarea>
<input id="size" type="number" value="3">

<button class="primary" onclick="makeGroup()">ğŸ² éš¨æ©Ÿåˆ†çµ„</button>
<button class="primary" onclick="drawOne()">ğŸ¯ æŠ½å­¸ç”Ÿ</button>
<button class="gray" onclick="exportCSV()">ğŸ“Š åŒ¯å‡º Excel</button>
<button class="gray" onclick="exportPDF()">ğŸ“„ åŒ¯å‡º PDF</button>

<div id="draw"></div>
<div id="result"></div>

<audio id="drawSound" src="sounds/draw.mp3"></audio>
<audio id="okSound" src="sounds/success.mp3"></audio>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>

<script>
let groups=[];
const drawSound=document.getElementById('drawSound');
const okSound=document.getElementById('okSound');

document.getElementById('students').value =
  localStorage.students||"";

document.getElementById('students').oninput=e=>
  localStorage.students=e.target.value;

function shuffle(a){
  for(let i=a.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [a[i],a[j]]=[a[j],a[i]];
  }
}

function makeGroup(){
  const students=document.getElementById('students').value
    .split('\n').filter(x=>x);
  const size=+document.getElementById('size').value;
  shuffle(students);
  groups=[];
  for(let i=0;i<students.length;i+=size)
    groups.push(students.slice(i,i+size));
  okSound.play();
  render();
}

function render(){
  const r=document.getElementById('result');
  r.innerHTML='';
  groups.forEach((g,i)=>{
    const d=document.createElement('div');
    d.className='group';
    d.innerHTML=`ç¬¬ ${i+1} çµ„ï¼š${g.join('ã€')}`;
    r.appendChild(d);
  });
}

function drawOne(){
  const students=document.getElementById('students').value
    .split('\n').filter(x=>x);
  if(!students.length) return;
  drawSound.play();
  const s=students[Math.floor(Math.random()*students.length)];
  const d=document.getElementById('draw');
  d.className='draw';
  d.textContent="ğŸ¯ æŠ½åˆ°ï¼š"+s;
}

function exportCSV(){
  let csv="çµ„åˆ¥,å­¸ç”Ÿ\n";
  groups.forEach((g,i)=>{
    g.forEach(s=>csv+=`ç¬¬${i+1}çµ„,${s}\n`);
  });
  const blob=new Blob(["\ufeff"+csv],{type:'text/csv'});
  const a=document.createElement('a');
  a.href=URL.createObjectURL(blob);
  a.download="åˆ†çµ„çµæœ.csv";
  a.click();
}

function exportPDF(){
  html2canvas(document.getElementById('result')).then(c=>{
    const pdf=new jspdf.jsPDF();
    const w=pdf.internal.pageSize.getWidth();
    const h=c.height*w/c.width;
    pdf.addImage(c.toDataURL(),'PNG',0,0,w,h);
    pdf.save("åˆ†çµ„çµæœ.pdf");
  });
}
</script>

</body>
</html>
