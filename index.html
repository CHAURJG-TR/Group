<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>åˆ†çµ„åº§ä½ç³»çµ±ï¼ˆå®Œæ•´ç‰ˆï¼‰</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{font-family:"Microsoft JhengHei",Arial;background:#f1f5f9;padding:20px}
h1{text-align:center}
textarea,button{width:100%;font-size:18px;padding:12px;margin:6px 0}
button{border:none;border-radius:12px;background:#2563eb;color:#fff;cursor:pointer}
#groups{display:grid;grid-template-columns:repeat(2,1fr);gap:24px;margin-top:20px}
.group{background:#e5e7eb;padding:14px;border-radius:16px}
.group h2{text-align:center}
.face{display:grid;grid-template-columns:1fr 1fr;gap:20px 40px;justify-items:center}
.seat,.back{background:#fff;width:120px;height:60px;border-radius:12px;display:flex;align-items:center;justify-content:center}
.back{background:#fde68a;margin:10px auto}
#podium{background:#f87171;color:#fff;font-weight:bold;text-align:center;padding:10px;border-radius:12px;width:120px;margin:0 auto 12px}
.fullscreen textarea,.fullscreen button{display:none}
.fullscreen .seat,.fullscreen .back{font-size:32px;height:100px}
</style>
</head>
<body>

<h1>åˆ†çµ„åº§ä½ç³»çµ±</h1>
<div id="podium">è¬›å°</div>

<textarea id="male" placeholder="ç”·ç”Ÿåå–®ï¼ˆ10 äººï¼Œæ¯è¡Œä¸€äººï¼‰"></textarea>
<textarea id="female" placeholder="å¥³ç”Ÿåå–®ï¼ˆ10 äººï¼Œæ¯è¡Œä¸€äººï¼‰"></textarea>
<textarea id="ban" placeholder="ä¸èƒ½åŒçµ„ï¼ˆå¤šäººå¯ï¼Œä¸€è¡Œä¸€æ¢ï¼Œç”¨ , åˆ†éš”ï¼‰"></textarea>

<button id="genBtn" onclick="makeGroups()">ç”Ÿæˆå°çµ„</button>
<button onclick="switchMode()">ğŸ“Š ç›´æ’æ¨¡å¼</button>
<button onclick="toggleFull()">ğŸ–¥ï¸ æŠ•å½±æ¨¡å¼</button>
<button onclick="exportPDF()">ğŸ–¨ï¸ åŒ¯å‡º PDF</button>
<button onclick="resetAll()">ğŸ”„ é‡è¨­</button>

<div id="groups"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>
let groupsData=[], columnMode=false, dragInfo=null

const parse = el => el.value.split("\n").map(s=>s.trim()).filter(Boolean)
const parseBans = () => parse(document.getElementById("ban")).map(l=>l.split(",").map(s=>s.trim()))
const shuffle = a => {for(let i=a.length-1;i>0;i--){let j=Math.random()*(i+1)|0;[a[i],a[j]]=[a[j],a[i]]}}

function impossibleRule(bans, groups){
  for(const r of bans) if(r.length > groups) return r
  return null
}

function validGroup(g,bans){return !bans.some(r=>r.every(n=>g.includes(n)))}

function makeGroups(){
  const male=parse(male), female=parse(female), bans=parseBans()
  if(male.length!==10||female.length!==10){alert("ç”·ç”Ÿã€å¥³ç”Ÿå„éœ€ 10 äºº");return}

  const bad = impossibleRule(bans,4)
  if(bad){alert("âŒ è¦å‰‡ä¸å¯èƒ½æˆç«‹\n\n"+bad.join("ã€"));return}

  for(let t=0;t<800;t++){
    shuffle(male); shuffle(female)
    let res=[], ok=true
    for(let i=0;i<4;i++){
      let g=i<2?male.splice(0,5):female.splice(0,5)
      if(!validGroup(g,bans)){ok=false;break}
      res.push(g)
    }
    if(ok){groupsData=res;render();return}
  }
  alert("âŒ è¦å‰‡è¡çªï¼Œç„¡æ³•å®Œæˆåˆ†çµ„")
}

function render(){
  const box=document.getElementById("groups")
  box.innerHTML=""
  if(columnMode){
    let all=groupsData.flat()
    for(let r=0;r<4;r++){
      let d=document.createElement("div")
      d.className="group"
      d.innerHTML=`<h2>ç¬¬ ${r+1} æ’</h2>`
      let f=document.createElement("div")
      f.className="face"
      f.style.gridTemplateColumns="repeat(5,1fr)"
      for(let c=0;c<5;c++){
        let s=document.createElement("div")
        s.className="seat"
        s.textContent=all[r*5+c]||""
        f.appendChild(s)
      }
      d.appendChild(f); box.appendChild(d)
    }
  }else{
    groupsData.forEach((g,i)=>{
      let d=document.createElement("div")
      d.className="group"
      d.innerHTML=`<h2>ç¬¬ ${i+1} çµ„</h2>
      <div class="face">${g.slice(0,4).map(n=>`<div class=seat>${n}</div>`).join("")}</div>
      <div class="back">${g[4]}</div>`
      box.appendChild(d)
    })
  }
}

function switchMode(){
  columnMode=!columnMode
  document.querySelector("button[onclick='switchMode()']").textContent=columnMode?"ğŸ“Š å°çµ„æ¨¡å¼":"ğŸ“Š ç›´æ’æ¨¡å¼"
  document.getElementById("genBtn").textContent=columnMode?"ç”Ÿæˆç›´æ’":"ç”Ÿæˆå°çµ„"
  render()
}

function toggleFull(){
  document.body.classList.toggle("fullscreen")
  document.fullscreenElement?document.exitFullscreen():document.documentElement.requestFullscreen()
}

function exportPDF(){
  html2canvas(document.body).then(c=>{
    const pdf=new jspdf.jsPDF("p","mm","a4")
    pdf.addImage(c.toDataURL(),"PNG",10,10,190,0)
    pdf.save("åº§ä½è¡¨.pdf")
  })
}

function resetAll(){
  if(confirm("ç¢ºå®šé‡è¨­ï¼Ÿ")){
    document.querySelectorAll("textarea").forEach(t=>t.value="")
    document.getElementById("groups").innerHTML=""
    columnMode=false
    document.getElementById("genBtn").textContent="ç”Ÿæˆå°çµ„"
    document.querySelector("button[onclick='switchMode()']").textContent="ğŸ“Š ç›´æ’æ¨¡å¼"
  }
}
</script>

</body>
</html>
