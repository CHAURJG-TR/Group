<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>æŠ½ç±¤åˆ†çµ„åº§ä½ç³»çµ±</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  font-family:"Microsoft JhengHei",Arial;
  background:#f1f5f9;
  padding:20px;
}
h1{text-align:center}

textarea,button{
  width:100%;
  font-size:18px;
  padding:12px;
  margin:6px 0;
}

button{
  border:none;
  border-radius:12px;
  background:#2563eb;
  color:#fff;
  cursor:pointer;
}

#groups{
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:24px;
  margin-top:20px;
}

.group{
  background:#e5e7eb;
  padding:14px;
  border-radius:16px;
  box-shadow:0 4px 10px rgba(0,0,0,.15);
}

.group h2{text-align:center}

.face{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:18px 40px;
  justify-items:center;
}

.seat,.back{
  background:#fff;
  width:110px;
  height:60px;
  border-radius:12px;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:18px;
}

.back{
  background:#fde68a;
  margin:10px auto 0;
}

/* æŠ½ç±¤ç•«é¢ */
#draw{
  position:fixed;
  inset:0;
  background:#020617;
  color:#fff;
  font-size:80px;
  display:none;
  align-items:center;
  justify-content:center;
  z-index:999;
}

.flash{animation:flash .2s alternate 6}
@keyframes flash{
  from{background:#020617}
  to{background:#2563eb}
}
</style>
</head>

<body>

<h1>ğŸ¯ æŠ½ç±¤åˆ†çµ„åº§ä½</h1>

<textarea id="students" rows="6"
placeholder="å­¸ç”Ÿåå–®ï¼ˆ20 äººï¼Œæ¯è¡Œä¸€äººï¼‰"></textarea>

<button onclick="drawAndGroup()">ğŸ¯ æŠ½ç±¤åˆ†çµ„ï¼ˆå‹•ç•«ï¼‰</button>
<button onclick="exportPDF()">ğŸ–¨ï¸ åŒ¯å‡º PDF</button>

<div id="groups"></div>
<div id="draw"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>
const drawEl = document.getElementById("draw");
const studentsEl = document.getElementById("students");
let groupsData=[];

function shuffle(a){
  for(let i=a.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [a[i],a[j]]=[a[j],a[i]];
  }
}

function drawAndGroup(){
  let list = studentsEl.value.split('\n').map(s=>s.trim()).filter(Boolean);
  if(list.length!==20){
    alert("âš ï¸ éœ€è¦å‰›å¥½ 20 äººï¼ˆ4 çµ„ï¼‰");
    return;
  }

  drawEl.style.display="flex";
  let t=30;
  const beep = new Audio("data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAESsAACJWAAACABAAZGF0YQAAAAA=");
  const timer=setInterval(()=>{
    drawEl.textContent = list[Math.floor(Math.random()*list.length)];
    beep.play();
    t--;
    if(t<=0){
      clearInterval(timer);
      drawEl.classList.add("flash");
      setTimeout(()=>{
        drawEl.style.display="none";
        drawEl.classList.remove("flash");
        makeGroups(list);
      },800);
    }
  },100);
}

function makeGroups(students){
  shuffle(students);
  groupsData=[];
  for(let i=0;i<4;i++){
    groupsData.push(students.slice(i*5,i*5+5));
  }
  render();
}

function render(){
  const box=document.getElementById("groups");
  box.innerHTML="";
  groupsData.forEach((g,i)=>{
    box.innerHTML+=`
    <div class="group">
      <h2>ç¬¬ ${i+1} çµ„</h2>
      <div class="face">
        <div class="seat">${g[0]}</div>
        <div class="seat">${g[1]}</div>
        <div class="seat">${g[2]}</div>
        <div class="seat">${g[3]}</div>
      </div>
      <div class="back">${g[4]}</div>
    </div>`;
  });
}

/* PDFï¼šç•«é¢è½‰æª”ï¼ˆä¸æœƒäº‚ç¢¼ï¼‰ */
function exportPDF(){
  const { jsPDF } = window.jspdf;
  html2canvas(document.getElementById("groups")).then(canvas=>{
    const pdf=new jsPDF("p","mm","a4");
    const img=canvas.toDataURL("image/png");
    const w=190;
    const h=canvas.height*w/canvas.width;
    pdf.addImage(img,"PNG",10,10,w,h);
    pdf.save("åˆ†çµ„åº§ä½è¡¨.pdf");
  });
}
</script>

</body>
</html>
